---
export interface Props {
  modalId: string;
  maxWidth?: string;
}

const { modalId, maxWidth = 'max-w-2xl' } = Astro.props;
---

<!-- Modal Dialog -->
<div
  id={modalId}
  class="bg-base/50 fixed inset-0 z-50 hidden items-center justify-center p-4 backdrop-blur-sm"
>
  <div
    class={`max-h-[80vh] w-full ${maxWidth} overflow-y-auto rounded-xl border border-border-900 bg-surface-900`}
  >
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-6">
      <button
        class="modal-close-btn bg-surface-900 border-border-900 hover:border-border-300 hover:bg-surface-700 flex h-8 w-8 cursor-pointer items-center justify-center rounded-md border text-xs font-semibold transition-colors duration-200"
        aria-label="Close modal"
        data-modal-id={modalId}
      >
        ESC
      </button>
    </div>

    <!-- Modal Content -->
    <div class="space-y-6 px-3">
      <slot />
    </div>
  </div>
</div>

<script define:vars={{ modalId }}>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById(modalId);
    const closeBtn = modal?.querySelector('.modal-close-btn');

    if (modal && closeBtn) {
      // Close modal on button click
      closeBtn.addEventListener('click', () => {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
      });

      // Close modal when clicking outside the content area
      modal.addEventListener('click', (event) => {
        if (event.target === modal) {
          modal.classList.add('hidden');
          modal.classList.remove('flex');
          document.body.style.overflow = 'auto';
        }
      });
    }
  });
  // Close modal on Escape key press
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      const modal = document.getElementById(modalId);
      if (modal && !modal.classList.contains('hidden')) {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = 'auto';
      }
    }
  });
</script>
